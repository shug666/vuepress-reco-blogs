---
title: android 耳机插拔状态的监测
date: 2022-12-22
tags:
 - android
categories: 
 - android
sticky: 
   true
---

 

手机有个很人性化的设计，随着耳机的插拔，媒体的音量会有两种不同的状态。推理，手机中必然有一种机制实现对耳机插拔的实时监测。本文章就对这种机制进行简单描述，只涉及应用层。有两种方法实现对耳机是否插入手机的监测：一种是采用广播方式实现实时监测，一种是调用Android内部接口。下面对两种方法进行详细描述。

## 1、广播方式

广播是Android中实现系统级消息通知的机制，灵活简单，如果某个软件要判断某个消息，只要简单的在软件中进行注册即可。耳机插入和拔出时会发出广播ACTION\_HEADSET\_PLUG，所以只要注册一个广播接受者就可以监听耳机的状态。

直接上代码：

```java
//广播处理接口
public class HeadSetChangeReceiver extends BroadcastReceiver {

    @Override

    public void onReceive(Context context, Intent intent) {

        if(intent.hasExtra("state")){

            if(intent.getIntExtra("state",0) == 0){        
                //断开耳机
                //可以加入自己想要处理的代码
                Toast.makeText(context,"discontent",Toast.LENGTH_SHORT).show();

            }else if(intent.getIntExtra("state",0) == 1){  
                //连接耳机
                Toast.makeText(context,"content",Toast.LENGTH_SHORT).show();

            }

        }

    }

}

public class MainActivity extends AppCompatActivity {

    private IntentFilter intentFilter;
    private HeadSetChangeReceiver headSetChangeReceiver;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        intentFilter = new IntentFilter();
        intentFilter.addAction("android.intent.action.HEADSET_PLUG");
        headSetChangeReceiver = new HeadSetChangeReceiver();
        registerReceiver(headSetChangeReceiver,intentFilter);  //注册广播
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        unregisterReceiver(headSetChangeReceiver);             //退出时一定要取消注册
    }
}
```

## 2、借用系统内部类

Android源码中 android.media.AudioManager 类有一个方法  isWiredHeadsetOn()  判断有线耳机是否连接，这个方法不是静态方法，所以不能直接调用。而且现在google 强烈反对（deprecated）使用这个方法，所以一般使用上面的方法实现对耳机的检测。

```java
private AudioManager audoManager;  
```

然后在activity的oncreate() 方法中取得对象

```java
audoManager = (AudioManager)getSystemService(Context.AUDIO_SERVICE); 
```

然后可以直接调用   audoManager.isWiredHeadsetOn(); 

具体代码如下：

```java
//需要申请权限
<uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" /> 

mainActivity.java 

  private AudioManager audioManager;

  @Override

  protected void onCreate(Bundle savedInstanceState) {
     super.onCreate(savedInstanceState);
     setContentView(R.layout.activity_main);

     audioManager = (AudioManager)getSystemService(Context.AUDIO_SERVICE);
     if(audioManager.isWiredHeadsetOn()) {
        //假如你要处理的代码
     }
}
```

第二种方法如果需要像广播那样实现实时监测，就需要在进程中键入while循环，或者采用异步处理机制，这就导致代码太过麻烦。对比不难发现，广播实现的更加优秀，代码合理，且对外检查很方便。
