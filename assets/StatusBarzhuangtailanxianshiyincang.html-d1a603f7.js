import{_ as p,r as o,o as t,c as e,b as n,d as s,e as c,a as l}from"./app-e8f85126.js";const r={},i=l(`<h2 id="_1-介绍" tabindex="-1"><a class="header-anchor" href="#_1-介绍" aria-hidden="true">#</a> 1. 介绍</h2><p>Android中的Statusbar包含导航栏(NavigationBar, 位于左侧、右侧或者底部)和状态栏(StatusBar, 位于顶部, 可下拉)两个部分, 位于SystemUI(frameworks/base/packages/SystemUI)模块</p><h2 id="_2-初始化" tabindex="-1"><a class="header-anchor" href="#_2-初始化" aria-hidden="true">#</a> 2. 初始化</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SystemServer</span><span class="token operator">::</span><span class="token function">startOtherServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token class-name">SystemServer</span><span class="token operator">::</span><span class="token function">startSystemUi</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.systemui.SystemUIService&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">SystemUIService</span><span class="token operator">::</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">/</span>\\<span class="token operator">*</span> 
       \\<span class="token operator">*</span> 加载并启动config\\_systemUIServiceComponents定义的服务列表
       \\<span class="token operator">*</span> frameworks<span class="token operator">/</span>base<span class="token operator">/</span>packages<span class="token operator">/</span><span class="token class-name">SystemUI</span><span class="token operator">/</span>res<span class="token operator">/</span>values<span class="token operator">/</span>config<span class="token punctuation">.</span>xml
       \\<span class="token operator">*</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token class-name">SystemUI</span> <span class="token class-name">Services</span><span class="token operator">:</span> <span class="token class-name">The</span> classes of the stuff <span class="token keyword">to</span> <span class="token namespace">start<span class="token punctuation">.</span></span> <span class="token operator">--</span><span class="token operator">&gt;</span>
       \\<span class="token operator">*</span> <span class="token operator">&lt;</span>string<span class="token operator">-</span>array name<span class="token operator">=</span><span class="token string">&quot;config\\_systemUIServiceComponents&quot;</span> translatable<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span>
       \\<span class="token operator">*</span>     <span class="token generics"><span class="token punctuation">&lt;</span>item<span class="token punctuation">&gt;</span></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>systemui<span class="token punctuation">.</span></span>Dependency</span><span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">&gt;</span>
       \\<span class="token operator">*</span>     <span class="token generics"><span class="token punctuation">&lt;</span>item<span class="token punctuation">&gt;</span></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>systemui<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span></span>CommandQueue</span>$<span class="token class-name">CommandQueueStart</span><span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">&gt;</span>
       \\<span class="token operator">*</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
       \\<span class="token operator">*</span>     <span class="token generics"><span class="token punctuation">&lt;</span>item<span class="token punctuation">&gt;</span></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>systemui<span class="token punctuation">.</span></span>SystemBars</span><span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">&gt;</span>
       \\<span class="token operator">*</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
       \\<span class="token operator">*</span>     <span class="token generics"><span class="token punctuation">&lt;</span>item<span class="token punctuation">&gt;</span></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>systemui<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span></span>KeyboardUI</span><span class="token operator">&lt;</span><span class="token operator">/</span>item<span class="token operator">&gt;</span>
       \\<span class="token operator">*</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
       \\<span class="token operator">*</span> <span class="token operator">&lt;</span><span class="token operator">/</span>string<span class="token operator">-</span>array<span class="token operator">&gt;</span>
       \\<span class="token operator">*</span><span class="token operator">/</span>
      <span class="token class-name">SystemUIApplication</span><span class="token operator">::</span><span class="token function">startServicesIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>systemui<span class="token punctuation">.</span></span>SystemBars</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">/</span>\\<span class="token operator">*</span> 
           \\<span class="token operator">*</span> 启动config\\_statusBarComponent定义的服务
           \\<span class="token operator">*</span> frameworks<span class="token operator">/</span>base<span class="token operator">/</span>packages<span class="token operator">/</span><span class="token class-name">SystemUI</span><span class="token operator">/</span>res<span class="token operator">/</span>values<span class="token operator">/</span>config<span class="token punctuation">.</span>xml
           \\<span class="token operator">*</span> <span class="token operator">&lt;</span>string name<span class="token operator">=</span><span class="token string">&quot;config\\_statusBarComponent&quot;</span> translatable<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span>
           \\<span class="token operator">*</span>     <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>systemui<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span>phone<span class="token punctuation">.</span></span>StatusBar</span>
           \\<span class="token operator">*</span> <span class="token operator">&lt;</span><span class="token operator">/</span>string<span class="token operator">&gt;</span>
           \\<span class="token operator">*</span>
           \\<span class="token operator">*</span> 在<span class="token class-name">Automotive</span>中被overlay<span class="token punctuation">,</span> <span class="token class-name">CarStatusBar</span>继承自<span class="token class-name">StatusBar</span>
           \\<span class="token operator">*</span> <span class="token operator">&lt;</span>string name<span class="token operator">=</span><span class="token string">&quot;config\\_statusBarComponent&quot;</span> translatable<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span>
           \\<span class="token operator">*</span>     <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>systemui<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span>car<span class="token punctuation">.</span></span>CarStatusBar</span>
           \\<span class="token operator">*</span> <span class="token operator">&lt;</span><span class="token operator">/</span>string<span class="token operator">&gt;</span>
           \\<span class="token operator">*</span><span class="token operator">/</span>
          <span class="token class-name">SystemBars</span><span class="token operator">::</span><span class="token function">createStatusBarFromConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">CarStatusBar</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token class-name">StatusBar</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token class-name">StatusBar</span><span class="token operator">::</span><span class="token function">createAndAddWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token class-name">StatusBar</span><span class="token operator">::</span><span class="token function">addStatusBarWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token class-name">CarStatusBar</span><span class="token operator">::</span><span class="token function">makeStatusBarView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token class-name">StatusBar</span><span class="token operator">::</span><span class="token function">makeStatusBarView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
\\<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
                        <span class="token operator">++</span><span class="token operator">+</span> <span class="token class-name">NavigationBar</span> <span class="token operator">++</span><span class="token operator">+</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
                        <span class="token class-name">WindowManagerService</span><span class="token operator">::</span><span class="token function">hasNavigationBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token operator">/</span>\\<span class="token operator">*</span> 
                           \\<span class="token operator">*</span> frameworks<span class="token operator">/</span>base<span class="token operator">/</span>core<span class="token operator">/</span>res<span class="token operator">/</span>res<span class="token operator">/</span>values<span class="token operator">/</span>config<span class="token punctuation">.</span>xml
                           \\<span class="token operator">*</span> <span class="token operator">&lt;</span>bool name<span class="token operator">=</span><span class="token string">&quot;config\\_showNavigationBar&quot;</span><span class="token operator">&gt;</span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>bool<span class="token operator">&gt;</span>
                           \\<span class="token operator">*</span>
                           \\<span class="token operator">*</span> 在<span class="token class-name">Automotive</span>中被overlay
                           \\<span class="token operator">*</span> <span class="token operator">&lt;</span>bool name<span class="token operator">=</span><span class="token string">&quot;config\\_showNavigationBar&quot;</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>bool<span class="token operator">&gt;</span>
                           \\<span class="token operator">*</span><span class="token operator">/</span>
                          <span class="token class-name">PhoneWindowManager</span><span class="token operator">::</span><span class="token function">hasNavigationBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token class-name">CarStatusBar</span><span class="token operator">::</span><span class="token function">createNavigationBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token operator">/</span>\\<span class="token operator">*</span> 
                           \\<span class="token operator">*</span> frameworks<span class="token operator">/</span>base<span class="token operator">/</span>packages<span class="token operator">/</span><span class="token class-name">SystemUI</span><span class="token operator">/</span>res<span class="token operator">/</span>values<span class="token operator">/</span>config<span class="token punctuation">.</span>xml
                           \\<span class="token operator">*</span> 根据如下配置决定是导航栏的位置，<span class="token class-name">Automotive</span>中会被overlay
                           \\<span class="token operator">*</span>   config\\_enableBottomNavigationBar
                           \\<span class="token operator">*</span>   config\\_enableLeftNavigationBar
                           \\<span class="token operator">*</span>   config\\_enableRightNavigationBar
                           \\<span class="token operator">*</span> 然后通过<span class="token class-name">WindowManager</span><span class="token operator">::</span><span class="token function">addView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>添加创建窗口
                           \\<span class="token operator">*</span>   <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span><span class="token constant">TYPE</span>\\_NAVIGATION\\_BAR
                           \\<span class="token operator">*</span>   <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span><span class="token constant">TYPE</span>\\_NAVIGATION\\_BAR\\_PANEL
                           \\<span class="token operator">*</span><span class="token operator">/</span>
                          <span class="token class-name">CarStatusBar</span><span class="token operator">::</span><span class="token function">buildNavBarWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token class-name">CarStatusBar</span><span class="token operator">::</span><span class="token function">buildNavBarContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token class-name">CarStatusBar</span><span class="token operator">::</span><span class="token function">attachNavBarWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
\\<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
                      <span class="token operator">++</span><span class="token operator">+</span> <span class="token class-name">StatusBar</span> <span class="token operator">++</span><span class="token operator">+</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
                          <span class="token operator">/</span>\\<span class="token operator">*</span> 加载<span class="token keyword">super</span>\\_status\\_bar<span class="token punctuation">.</span>xml实例化为状态栏的根控件 \\<span class="token operator">*</span><span class="token operator">/</span>
                          <span class="token class-name">StatusBar</span><span class="token operator">::</span><span class="token function">inflateStatusBarWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token operator">/</span>\\<span class="token operator">*</span> 
                       \\<span class="token operator">*</span> 通过<span class="token class-name">WindowManager</span><span class="token operator">::</span><span class="token function">addView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>添加窗口<span class="token punctuation">,</span> 类型如下
                       \\<span class="token operator">*</span>   <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span><span class="token constant">TYPE</span>\\_STATUS\\_BAR
                       \\<span class="token operator">*</span><span class="token operator">/</span>
                      <span class="token class-name">StatusBarWindowManager</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-保留状态栏-适配全面屏" tabindex="-1"><a class="header-anchor" href="#_3-保留状态栏-适配全面屏" aria-hidden="true">#</a> 3. 保留状态栏，适配全面屏</h2><p>默认情况下，应用界面不会延伸到系统状态栏、导航栏、导航条等区域，这会很丑，要想适配全面屏显示，在 Android 14 中，可以用一行代码简单实现。</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">// import androidx.activity.enableEdgeToEdg</span>

<span class="token function">enableEdgeToEdge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-隐藏状态栏-完全全屏" tabindex="-1"><a class="header-anchor" href="#_4-隐藏状态栏-完全全屏" aria-hidden="true">#</a> 4. 隐藏状态栏，完全全屏</h2><p>适配全面屏并不会隐藏系统状态栏、导航栏、导航条，如果想实现完全全屏，老办法一般是调用 <code>setSystemUiVisibility()</code>，然而这个方法在 14 中已经弃用了，获取 <code>InsetsController</code> 的 <code>ViewCompat.getWindowInsetsController()</code> 方法也被弃用了，最新的写法是：</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">// import androidx.core.view.WindowCompat</span>
<span class="token comment">// import androidx.core.view.WindowInsetsCompat</span>
<span class="token comment">// import androidx.core.view.WindowInsetsControllerCompat</span>

<span class="token keyword">val</span> windowController <span class="token operator">=</span> WindowCompat<span class="token punctuation">.</span><span class="token function">getInsetsController</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> window<span class="token punctuation">.</span>decorView<span class="token punctuation">)</span>
<span class="token comment">// 应用全屏时，用户仍然可以从屏幕顶部下拉唤出状态栏，此行代码实现当用户唤出状态栏后，自动隐藏状态栏</span>
windowController<span class="token punctuation">.</span>systemBarsBehavior <span class="token operator">=</span> WindowInsetsControllerCompat<span class="token punctuation">.</span>BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE
<span class="token comment">// 隐藏包括状态栏、导航栏、caption bar 在内的所有系统栏</span>
windowController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span>WindowInsetsCompat<span class="token punctuation">.</span>Type<span class="token punctuation">.</span><span class="token function">systemBars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>显示和隐藏</li></ol><hr><p><strong>前提：较低的Android版本</strong></p><h3 id="_5-1-应用实例" tabindex="-1"><a class="header-anchor" href="#_5-1-应用实例" aria-hidden="true">#</a> 5.1 应用实例</h3><p>应用可以通过如下的方式隐藏状态栏和导航栏</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Android &lt; 4:</span>
<span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span><span class="token constant">FLAG</span>\\_FULLSCREEN<span class="token punctuation">,</span>
                     <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span><span class="token constant">FLAG</span>\\_FULLSCREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4 =&lt; Android &lt; 11:</span>
<span class="token keyword">int</span> uiFlags <span class="token operator">=</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM</span>\\_UI\\_FLAG\\_LAYOUT\\_FULLSCREEN
            <span class="token operator">|</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM</span>\\_UI\\_FLAG\\_LAYOUT\\_HIDE\\_NAVIGATION
            <span class="token operator">|</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM</span>\\_UI\\_FLAG\\_FULLSCREEN
            <span class="token operator">|</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM</span>\\_UI\\_FLAG\\_HIDE\\_NAVIGATION<span class="token punctuation">;</span>
<span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span>uiFlags<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Android &gt;= 11</span>
<span class="token operator">/</span>\\<span class="token operator">*</span>
 \\<span class="token operator">*</span> systemBars包含statusBars和navigationBars
 \\<span class="token operator">*</span><span class="token operator">/</span>
<span class="token comment">// WindowInsetsController</span>
controller<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token class-name">WindowInsetsCompat<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token function">systemBars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
controller<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token class-name">WindowInsetsCompat<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token function">systemBars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="flag大全及其含义" tabindex="-1"><a class="header-anchor" href="#flag大全及其含义" aria-hidden="true">#</a> Flag大全及其含义</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>FLAG_ALLOW_LOCK_WHILE_SCREEN_ON：允许在屏幕开启的情况下锁定屏幕。

FLAG_ALT_FOCUSABLE_IM：当界面上有输入框时，该标志可以让输入法在弹出后覆盖输入框之上。

FLAG_DIM_BEHIND：在当前Activity之后的Activity中设置一个灰色透明遮罩层。

FLAG_FORCE_NOT_FULLSCREEN：当前Activity不全屏显示，即显示状态栏。

FLAG_FULLSCREEN：当前Activity全屏显示，即隐藏状态栏。

FLAG_HARDWARE_ACCELERATED：启用硬件加速。

FLAG_IGNORE_CHEEK_PRESSES：忽略面颊触碰。

FLAG_KEEP_SCREEN_ON：保持屏幕常亮。

FLAG_LAYOUT_INSET_DECOR：使窗口的内容布局在装饰视图之内。

FLAG_LAYOUT_IN_SCREEN：使窗口的内容布局在整个屏幕之内。

FLAG_LAYOUT_NO_LIMITS：窗口布局不受限制，可以覆盖状态栏、导航栏、装饰视图等。

FLAG_NOT_FOCUSABLE：窗口不可获得焦点。

FLAG_NOT_TOUCHABLE：窗口不可触摸。

FLAG_NOT_TOUCH_MODAL：当窗口在前面时，允许在窗口之外触摸事件传递到后面的窗口。

FLAG_SCALED：窗口内容按比例缩放。

FLAG_SECURE：窗口内容不可截屏。

FLAG_SHOW_WALLPAPER：在窗口背景中显示壁纸。

FLAG_SPLIT_TOUCH：分离触摸模式。

FLAG_WATCH_OUTSIDE_TOUCH：当窗口在前面时，允许在窗口之外触摸事件传递到后面的窗口。

FLAG_BLUR_BEHIND：在当前Activity之后的Activity中设置一个模糊透明遮罩层。

FLAG_DISMISS_KEYGUARD：解锁屏幕，需要权限。

FLAG_DITHER：启用抖动。

FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS：使窗口内容延伸到状态栏和导航栏之下。

FLAG_LAYOUT_ATTACHED_IN_DECOR：使窗口的内容布局在装饰视图之内，并显示在导航栏之上。

FLAG_LAYOUT_IN_OVERSCAN：窗口布局延伸到屏幕边缘之外，需要权限。

FLAG_LOCAL_FOCUS_MODE：窗口内部获得焦点，外部不可获得焦点。

FLAG_SHOW_WHEN_LOCKED：在锁屏状态下显示当前Activity。

FLAG_TOUCHABLE_WHEN_WAKING：在唤醒设备时，允许触摸事件传递到窗口之外。

FLAG_TRANSLUCENT_NAVIGATION：使导航栏半透明。

FLAG_TRANSLUCENT_STATUS：使状态栏半透明。

FLAG_TURN_SCREEN_ON：唤醒设备，需要权限。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-调用流程" tabindex="-1"><a class="header-anchor" href="#_5-2-调用流程" aria-hidden="true">#</a> 5.2 调用流程</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">View</span><span class="token operator">::</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">recomputeViewAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">scheduleTraversals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">doTraversal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">performTraversals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">collectViewAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token class-name">View</span><span class="token operator">::</span><span class="token function">dispatchCollectViewAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token class-name">View</span><span class="token operator">::</span><span class="token function">performCollectViewAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token comment">// Do Something</span>
              <span class="token class-name">View</span><span class="token operator">::</span><span class="token function">dispatchWindowSystemUiVisiblityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">relayoutWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token class-name">IWindowSession</span><span class="token operator">::</span><span class="token function">relayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>server<span class="token punctuation">.</span>wm<span class="token punctuation">.</span></span>Session</span><span class="token operator">::</span><span class="token function">relayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token class-name">WindowManagerService</span><span class="token operator">::</span><span class="token function">relayoutWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token class-name">PhoneWindowManager</span><span class="token operator">::</span><span class="token function">adjustWindowParamsLw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
\\<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
                <span class="token operator">++</span><span class="token operator">+</span> <span class="token class-name">How</span> <span class="token keyword">to</span> <span class="token namespace">get</span> here <span class="token operator">++</span><span class="token operator">+</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
                <span class="token class-name">PhoneWindowManager</span><span class="token operator">::</span><span class="token function">updateSystemUiVisibilityLw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token class-name">StatusBarManagerService</span><span class="token operator">::</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token class-name">IStatusBar</span><span class="token operator">::</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token class-name">CommandQueue</span><span class="token operator">::</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token class-name">StatusBar</span><span class="token operator">::</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                          <span class="token class-name">StatusBar</span><span class="token operator">::</span><span class="token function">notifyUiVisibilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token class-name">WindowManagerService</span><span class="token operator">::</span><span class="token function">statusBarVisibilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                              <span class="token class-name">PhoneWindowManager</span><span class="token operator">::</span><span class="token function">adjustSystemUiVisibilityLw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                              <span class="token class-name">WindowManagerService</span><span class="token operator">::</span><span class="token function">updateStatusBarVisibilityLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token class-name">InputManagerService</span><span class="token operator">::</span><span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token class-name">DisplayContent</span><span class="token operator">::</span><span class="token function">updateSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                  <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token class-name">W</span><span class="token operator">::</span><span class="token function">dispatchSystemUiVisibilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">dispatchSystemUiVisibilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                      <span class="token class-name">ViewRootImpl</span><span class="token operator">::</span><span class="token function">handleDispatchSystemUiVisibilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token class-name">View</span><span class="token operator">::</span><span class="token function">updateLocalSystemUiVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token class-name">View</span><span class="token operator">::</span><span class="token function">dispatchSystemUiVisibilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                          <span class="token class-name">OnSystemUiVisibilityChangeListener</span><span class="token operator">::</span><span class="token function">onSystemUiVisibilityChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;[Android 9.0 SystemUI分析](https://wuxiaolong.me/categories/SystemUI/)\\&gt;  

&lt;[StatusBar状态栏部分功能记录](https://blog.csdn.net/lanmengfenghe/article/details/104003765)\\&gt;  

&lt;[Android 显示、隐藏状态栏和导航栏](https://www.jianshu.com/p/e9e443271c98)\\&gt;  

&lt;[Android SystemUI(一):图文并茂的介绍](https://cloud.tencent.com/developer/article/1155393)\\&gt;  

&lt;[API 30新特性：WindowInsetsController](https://juejin.cn/post/6940048488071856164)\\&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22),k={href:"https://www.cnblogs.com/hzl6255/p/15027685.html",target:"_blank",rel:"noopener noreferrer"};function u(d,v){const a=o("ExternalLinkIcon");return t(),e("div",null,[i,n("p",null,[s("本文转自 "),n("a",k,[s("https://www.cnblogs.com/hzl6255/p/15027685.html"),c(a)]),s("，如有侵权，请联系删除。")])])}const b=p(r,[["render",u],["__file","StatusBarzhuangtailanxianshiyincang.html.vue"]]);export{b as default};
