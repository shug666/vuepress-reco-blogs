import{_ as n,o as s,c as a,a as t}from"./app-e8f85126.js";const p={},e=t(`<h2 id="_1-概述" tabindex="-1"><a class="header-anchor" href="#_1-概述" aria-hidden="true">#</a> 1. 概述</h2><p>在13.0的系统rom定制化开发中，在laucher3的某些功能中，在拖拽item时 靠近某个图标时会形成文件夹（folder）, 而根据客户需求不想再hotseat形成文件夹， 这就要从workspace.java从来寻找解决方案了分析hotseat是怎么变成 folder的，接下来具体实现相关功能</p><h2 id="_2-核心代码" tabindex="-1"><a class="header-anchor" href="#_2-核心代码" aria-hidden="true">#</a> 2. 核心代码</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">/</span>packages<span class="token operator">/</span>apps<span class="token operator">/</span><span class="token class-name">Launcher3</span><span class="token operator">/</span>src<span class="token operator">/</span>com<span class="token operator">/</span>android<span class="token operator">/</span>launcher3<span class="token operator">/</span><span class="token class-name">Workspace</span><span class="token punctuation">.</span>java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3-功能分析和实现" tabindex="-1"><a class="header-anchor" href="#_3-功能分析和实现" aria-hidden="true">#</a> 3. 功能分析和实现</h2><p>在Launcher3中长按桌面图标在拖动app图标，当靠近某个app的图标的时候，这时候这两个app图标就会形成文件夹图标FolderIcon的缩略图。</p><p>打开的文件夹叫Folder，桌面上和图标一样的文件夹叫FolderIcon，文件夹的主要逻辑代码都在<code>Launcher\\src\\com\\android\\launcher3\\folder</code>包下面</p><p>在Launcher3中添加默认文件夹就是通过添加folder中的，然后展开文件夹后，显示当前的item图标，而关于folder文件夹的布局就是<code>user_folder_icon_normalized.xml</code> 在Launcher3中形成文件夹的主要流程，就是在Workspace.java中的onDrop()方法里面实现的，在这里会根据拖拽释放的时候，根据拖动图标落点处可以合成一个Folder，如果满足文件夹的条件， 调用CellLayout.java的performReorder方法来形成文件夹，最主要的方法就是createUserFolderIfNecessary()方法来实现创建文件夹功能</p><h3 id="_3-1-取消创建文件夹" tabindex="-1"><a class="header-anchor" href="#_3-1-取消创建文件夹" aria-hidden="true">#</a> 3.1 取消创建文件夹</h3><p>在Launcher3 中,工作区(Workspace)是指桌面上显示应用程序和小部件的区域</p><p>Workspace.java: 抽象的桌面。由N个cellLayout组成,从cellLayout更高一级的层面上对事件的处理。接下来分析下Folder文件夹形成的过程</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token keyword">boolean</span> <span class="token function">createUserFolderIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">View</span> newView<span class="token punctuation">,</span> <span class="token keyword">int</span> container<span class="token punctuation">,</span> <span class="token class-name">CellLayout</span> target<span class="token punctuation">,</span>
              <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> targetCell<span class="token punctuation">,</span> <span class="token keyword">float</span> distance<span class="token punctuation">,</span> <span class="token keyword">boolean</span> external<span class="token punctuation">,</span> <span class="token class-name">DragObject</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&gt;</span> target<span class="token punctuation">.</span><span class="token function">getFolderCreationRadius</span><span class="token punctuation">(</span>targetCell<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token class-name">View</span> v <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getChildAt</span><span class="token punctuation">(</span>targetCell<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> targetCell<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
          <span class="token keyword">boolean</span> hasntMoved <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>mDragInfo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token class-name">CellLayout</span> cellParent <span class="token operator">=</span> <span class="token function">getParentCellLayoutForView</span><span class="token punctuation">(</span>mDragInfo<span class="token punctuation">.</span>cell<span class="token punctuation">)</span><span class="token punctuation">;</span>
              hasntMoved <span class="token operator">=</span> <span class="token punctuation">(</span>mDragInfo<span class="token punctuation">.</span>cellX <span class="token operator">==</span> targetCell<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
                      mDragInfo<span class="token punctuation">.</span>cellY <span class="token operator">==</span> targetCell<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>cellParent <span class="token operator">==</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
  
          <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> hasntMoved <span class="token operator">||</span> <span class="token operator">!</span>mCreateUserFolderOnDrop<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          mCreateUserFolderOnDrop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token keyword">final</span> <span class="token keyword">int</span> screenId <span class="token operator">=</span> <span class="token function">getIdForScreen</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
          <span class="token keyword">boolean</span> aboveShortcut <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">WorkspaceItemInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">boolean</span> willBecomeShortcut <span class="token operator">=</span> <span class="token punctuation">(</span>newView<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">WorkspaceItemInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
          <span class="token keyword">if</span> <span class="token punctuation">(</span>aboveShortcut <span class="token operator">&amp;&amp;</span> willBecomeShortcut<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token class-name">WorkspaceItemInfo</span> sourceInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WorkspaceItemInfo</span><span class="token punctuation">)</span> newView<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">WorkspaceItemInfo</span> destInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WorkspaceItemInfo</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// if the drag started here, we need to remove it from the workspace</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>external<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">getParentCellLayoutForView</span><span class="token punctuation">(</span>mDragInfo<span class="token punctuation">.</span>cell<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>mDragInfo<span class="token punctuation">.</span>cell<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
  
              <span class="token class-name">Rect</span> folderLocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">float</span> scale <span class="token operator">=</span> mLauncher<span class="token punctuation">.</span><span class="token function">getDragLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDescendantRectRelativeToSelf</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> folderLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
              target<span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
              mStatsLogManager<span class="token punctuation">.</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withItemInfo</span><span class="token punctuation">(</span>destInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withInstanceId</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>logInstanceId<span class="token punctuation">)</span>
                      <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">LauncherEvent</span><span class="token punctuation">.</span><span class="token constant">LAUNCHER_ITEM_DROP_FOLDER_CREATED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">FolderIcon</span> fi <span class="token operator">=</span> mLauncher<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> container<span class="token punctuation">,</span> screenId<span class="token punctuation">,</span> targetCell<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      targetCell<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              destInfo<span class="token punctuation">.</span>cellX <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
              destInfo<span class="token punctuation">.</span>cellY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
              sourceInfo<span class="token punctuation">.</span>cellX <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
              sourceInfo<span class="token punctuation">.</span>cellY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  
              <span class="token comment">// If the dragView is null, we can&#39;t animate</span>
              <span class="token keyword">boolean</span> animate <span class="token operator">=</span> d <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>animate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// In order to keep everything continuous, we hand off the currently rendered</span>
                  <span class="token comment">// folder background to the newly created icon. This preserves animation state.</span>
                  fi<span class="token punctuation">.</span><span class="token function">setFolderBackground</span><span class="token punctuation">(</span>mFolderCreateBg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  mFolderCreateBg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreviewBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  fi<span class="token punctuation">.</span><span class="token function">performCreateAnimation</span><span class="token punctuation">(</span>destInfo<span class="token punctuation">,</span> v<span class="token punctuation">,</span> sourceInfo<span class="token punctuation">,</span> d<span class="token punctuation">,</span> folderLocation<span class="token punctuation">,</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  fi<span class="token punctuation">.</span><span class="token function">prepareCreateAnimation</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  fi<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>destInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  fi<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>sourceInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过上述的分析得知，CellLayout.java相关方法分析得知，在createUserFolderIfNecessary方法主要是生成文件夹的操作，所以不想再hotseat形成文件夹就做如下修改:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token keyword">boolean</span> <span class="token function">createUserFolderIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">View</span> newView<span class="token punctuation">,</span> <span class="token keyword">long</span> container<span class="token punctuation">,</span> <span class="token class-name">CellLayout</span> target<span class="token punctuation">,</span>
                <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> targetCell<span class="token punctuation">,</span> <span class="token keyword">float</span> distance<span class="token punctuation">,</span> <span class="token keyword">boolean</span> external<span class="token punctuation">,</span> <span class="token class-name">DragView</span> dragView<span class="token punctuation">,</span>
                <span class="token class-name">Runnable</span> postAnimationRunnable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//core begin</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>container <span class="token operator">==</span> <span class="token class-name">LauncherSettings<span class="token punctuation">.</span>Favorites</span><span class="token punctuation">.</span><span class="token constant">CONTAINER_HOTSEAT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//core end</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&gt;</span> mMaxDistanceForFolderCreation<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token class-name">View</span> v <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getChildAt</span><span class="token punctuation">(</span>targetCell<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> targetCell<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改完以后运行一下，发现确实有效果 但是在HotSeat中拖动一个APP放到目标APP上方仍然会有一个文件夹的虚影</p><p>继续在workspace.java中看到了manageFolderFeedback()，管理文件夹进入方法看下：</p><h3 id="_3-2-取消动画虚影" tabindex="-1"><a class="header-anchor" href="#_3-2-取消动画虚影" aria-hidden="true">#</a> 3.2 取消动画虚影</h3><p>通过上述的分析得知，Workspace.java的核心功能就是负责加载app图标folder文件夹widget微件功能，接下来看下folder的相关功能</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">manageFolderFeedback</span><span class="token punctuation">(</span><span class="token keyword">float</span> distance<span class="token punctuation">,</span> <span class="token class-name">DragObject</span> dragObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&gt;</span> mDragTargetLayout<span class="token punctuation">.</span><span class="token function">getFolderCreationRadius</span><span class="token punctuation">(</span>mTargetCell<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_ADD_TO_FOLDER</span>
                      <span class="token operator">||</span> mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_CREATE_FOLDER</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">setDragMode</span><span class="token punctuation">(</span><span class="token constant">DRAG_MODE_NONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
  
          <span class="token keyword">final</span> <span class="token class-name">View</span> dragOverView <span class="token operator">=</span> mDragTargetLayout<span class="token punctuation">.</span><span class="token function">getChildAt</span><span class="token punctuation">(</span>mTargetCell<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mTargetCell<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">ItemInfo</span> info <span class="token operator">=</span> dragObject<span class="token punctuation">.</span>dragInfo<span class="token punctuation">;</span>
          <span class="token keyword">boolean</span> userFolderPending <span class="token operator">=</span> <span class="token function">willCreateUserFolder</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> dragOverView<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_NONE</span> <span class="token operator">&amp;&amp;</span> userFolderPending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
              mFolderCreateBg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreviewBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              mFolderCreateBg<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>mLauncher<span class="token punctuation">,</span> mLauncher<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                      dragOverView<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dragOverView<span class="token punctuation">.</span><span class="token function">getPaddingTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
              <span class="token comment">// The full preview background should appear behind the icon</span>
              mFolderCreateBg<span class="token punctuation">.</span>isClipping <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  
              mFolderCreateBg<span class="token punctuation">.</span><span class="token function">animateToAccept</span><span class="token punctuation">(</span>mDragTargetLayout<span class="token punctuation">,</span> mTargetCell<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mTargetCell<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              mDragTargetLayout<span class="token punctuation">.</span><span class="token function">clearDragOutlines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">setDragMode</span><span class="token punctuation">(</span><span class="token constant">DRAG_MODE_CREATE_FOLDER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
              <span class="token keyword">if</span> <span class="token punctuation">(</span>dragObject<span class="token punctuation">.</span>stateAnnouncer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  dragObject<span class="token punctuation">.</span>stateAnnouncer<span class="token punctuation">.</span><span class="token function">announce</span><span class="token punctuation">(</span><span class="token class-name">WorkspaceAccessibilityHelper</span>
                          <span class="token punctuation">.</span><span class="token function">getDescriptionForDropOver</span><span class="token punctuation">(</span>dragOverView<span class="token punctuation">,</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
  
          <span class="token keyword">boolean</span> willAddToFolder <span class="token operator">=</span> <span class="token function">willAddToExistingUserFolder</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> dragOverView<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>willAddToFolder <span class="token operator">&amp;&amp;</span> mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_NONE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              mDragOverFolderIcon <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">FolderIcon</span><span class="token punctuation">)</span> dragOverView<span class="token punctuation">)</span><span class="token punctuation">;</span>
              mDragOverFolderIcon<span class="token punctuation">.</span><span class="token function">onDragEnter</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>mDragTargetLayout <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  mDragTargetLayout<span class="token punctuation">.</span><span class="token function">clearDragOutlines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token function">setDragMode</span><span class="token punctuation">(</span><span class="token constant">DRAG_MODE_ADD_TO_FOLDER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
              <span class="token keyword">if</span> <span class="token punctuation">(</span>dragObject<span class="token punctuation">.</span>stateAnnouncer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  dragObject<span class="token punctuation">.</span>stateAnnouncer<span class="token punctuation">.</span><span class="token function">announce</span><span class="token punctuation">(</span><span class="token class-name">WorkspaceAccessibilityHelper</span>
                          <span class="token punctuation">.</span><span class="token function">getDescriptionForDropOver</span><span class="token punctuation">(</span>dragOverView<span class="token punctuation">,</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
  
          <span class="token keyword">if</span> <span class="token punctuation">(</span>mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_ADD_TO_FOLDER</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>willAddToFolder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">setDragMode</span><span class="token punctuation">(</span><span class="token constant">DRAG_MODE_NONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_CREATE_FOLDER</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>userFolderPending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">setDragMode</span><span class="token punctuation">(</span><span class="token constant">DRAG_MODE_NONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在manageFolderFeedback()中的boolean userFolderPending变量就是决定在拖拽的时候是否会有阴影产生的，所以就让这里为false就好了, 改完后测试发现找到解决方法: 修改如下:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">manageFolderFeedback</span><span class="token punctuation">(</span><span class="token keyword">float</span> distance<span class="token punctuation">,</span> <span class="token class-name">DragObject</span> dragObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&gt;</span> mDragTargetLayout<span class="token punctuation">.</span><span class="token function">getFolderCreationRadius</span><span class="token punctuation">(</span>mTargetCell<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_ADD_TO_FOLDER</span>
                      <span class="token operator">||</span> mDragMode <span class="token operator">==</span> <span class="token constant">DRAG_MODE_CREATE_FOLDER</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">setDragMode</span><span class="token punctuation">(</span><span class="token constant">DRAG_MODE_NONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
  
          <span class="token keyword">final</span> <span class="token class-name">View</span> dragOverView <span class="token operator">=</span> mDragTargetLayout<span class="token punctuation">.</span><span class="token function">getChildAt</span><span class="token punctuation">(</span>mTargetCell<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mTargetCell<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">ItemInfo</span> info <span class="token operator">=</span> dragObject<span class="token punctuation">.</span>dragInfo<span class="token punctuation">;</span>
     
          <span class="token operator">-</span>  <span class="token keyword">boolean</span> userFolderPending <span class="token operator">=</span> <span class="token function">willCreateUserFolder</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> dragOverView<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token operator">+</span> <span class="token keyword">boolean</span> userFolderPending <span class="token operator">=</span> <span class="token function">willCreateUserFolder</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> dragOverView<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                    <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mLauncher<span class="token punctuation">.</span><span class="token function">isHotseatLayout</span><span class="token punctuation">(</span>targetLayout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,21),o=[e];function c(l,u){return s(),a("div",null,o)}const r=n(p,[["render",c],["__file","HotseatjinzhichuangjianFolderwenjianjia.html.vue"]]);export{r as default};
