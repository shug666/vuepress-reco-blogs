import{_ as e,r as p,o as t,c as o,b as n,d as s,e as c,a as l}from"./app-52856ff7.js";const r={},i=l(`<h2 id="_1-app需要拥有系统签名" tabindex="-1"><a class="header-anchor" href="#_1-app需要拥有系统签名" aria-hidden="true">#</a> 1 app需要拥有系统签名</h2><p>如下Android.bp文件中需要配置 certificate: “platform”，表示平台签名。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>android_app <span class="token punctuation">{</span>
    name: <span class="token string">&quot;Settings&quot;</span>,
    defaults: <span class="token punctuation">[</span><span class="token string">&quot;platform_app_defaults&quot;</span><span class="token punctuation">]</span>,
    platform_apis: true,
    certificate: <span class="token string">&quot;platform&quot;</span>,
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-配置android-shareduserid" tabindex="-1"><a class="header-anchor" href="#_2-配置android-shareduserid" aria-hidden="true">#</a> 2 配置android:sharedUserId</h2><p>app需要在AndroidManifest.xml中配置android:sharedUserId=“android.uid.system”</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xindawn<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>versionCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>versionName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>sharedUserId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.uid.system<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>protected-broadcast</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.vt.dlna.PARAM_DEV_UPDATE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上两步是否成功可以通过执行**<code>adb shell ps -AZ| grep “xxx”</code>** 查看，</p><p><strong>untrusted_app</strong>表示三方app，无系统签名</p><p><strong>system_app</strong>表示系统app，有系统签名+配置 android:sharedUserId=“android.uid.system”。</p><p><strong>platform_app</strong>表示平台app，有系统签名。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>u:r:untrusted_app_30:s0:c56,c+ u0_a56        <span class="token number">1765</span>   <span class="token number">331</span> <span class="token number">14482280</span> <span class="token number">93484</span> <span class="token number">0</span>                   <span class="token number">0</span> S com.android.calendar
u:r:system_app:s0              system        <span class="token number">1464</span>   <span class="token number">331</span> <span class="token number">14633576</span> <span class="token number">120228</span> <span class="token number">0</span>                  <span class="token number">0</span> S system:ui
u:r:platform_app:s0:c512,c768  u0_a14        <span class="token number">2035</span>   <span class="token number">331</span> <span class="token number">14604764</span> <span class="token number">97872</span> <span class="token number">0</span>                   <span class="token number">0</span> S com.android.statementservice
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-广播需要配置成保护广播" tabindex="-1"><a class="header-anchor" href="#_3-广播需要配置成保护广播" aria-hidden="true">#</a> 3 广播需要配置成保护广播</h2><p>否则不能正常发送于接收。报错如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> <span class="token class-name">Sending</span> non<span class="token operator">-</span><span class="token keyword">protected</span> broadcast com<span class="token punctuation">.</span>xindawn<span class="token punctuation">.</span><span class="token constant">PARAM_DEV_UPDATE</span> from system <span class="token number">2335</span><span class="token operator">:</span>com<span class="token punctuation">.</span>xindawn<span class="token operator">/</span><span class="token number">1000</span> pkg com<span class="token punctuation">.</span>xindawn
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Throwable</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>server<span class="token punctuation">.</span>am<span class="token punctuation">.</span></span>ActivityManagerService</span><span class="token punctuation">.</span><span class="token function">checkBroadcastFromSystem</span><span class="token punctuation">(</span><span class="token class-name">ActivityManagerService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">13561</span><span class="token punctuation">)</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>server<span class="token punctuation">.</span>am<span class="token punctuation">.</span></span>ActivityManagerService</span><span class="token punctuation">.</span><span class="token function">broadcastIntentLocked</span><span class="token punctuation">(</span><span class="token class-name">ActivityManagerService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">14283</span><span class="token punctuation">)</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>server<span class="token punctuation">.</span>am<span class="token punctuation">.</span></span>ActivityManagerService</span><span class="token punctuation">.</span><span class="token function">broadcastIntentLocked</span><span class="token punctuation">(</span><span class="token class-name">ActivityManagerService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">13579</span><span class="token punctuation">)</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>server<span class="token punctuation">.</span>am<span class="token punctuation">.</span></span>ActivityManagerService</span><span class="token punctuation">.</span><span class="token function">broadcastIntentWithFeature</span><span class="token punctuation">(</span><span class="token class-name">ActivityManagerService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">14457</span><span class="token punctuation">)</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span>IActivityManager</span>$<span class="token class-name">Stub</span><span class="token punctuation">.</span><span class="token function">onTransact</span><span class="token punctuation">(</span><span class="token class-name">IActivityManager</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2296</span><span class="token punctuation">)</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>server<span class="token punctuation">.</span>am<span class="token punctuation">.</span></span>ActivityManagerService</span><span class="token punctuation">.</span><span class="token function">onTransact</span><span class="token punctuation">(</span><span class="token class-name">ActivityManagerService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2628</span><span class="token punctuation">)</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Binder</span><span class="token punctuation">.</span><span class="token function">execTransactInternal</span><span class="token punctuation">(</span><span class="token class-name">Binder</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1280</span><span class="token punctuation">)</span>
<span class="token number">07</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">42.633</span>   <span class="token number">527</span>  <span class="token number">1040</span> <span class="token class-name">E</span> <span class="token class-name">ActivityManager</span><span class="token operator">:</span> 	at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Binder</span><span class="token punctuation">.</span><span class="token function">execTransact</span><span class="token punctuation">(</span><span class="token class-name">Binder</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1244</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置方法如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>frameworks/base/core$ <span class="token function">git</span> <span class="token function">diff</span>
<span class="token function">diff</span> <span class="token parameter variable">--git</span> a/core/res/AndroidManifest.xml b/core/res/AndroidManifest.xml
+++ b/core/res/AndroidManifest.xml
@@ -817,6 +817,8 @@
     <span class="token operator">&lt;</span>protected-broadcast android:name<span class="token operator">=</span><span class="token string">&quot;android.service.autofill.action.DELAYED_FILL&quot;</span> /<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>protected-broadcast android:name<span class="token operator">=</span><span class="token string">&quot;android.app.action.PROVISIONING_COMPLETED&quot;</span> /<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>protected-broadcast android:name<span class="token operator">=</span><span class="token string">&quot;android.app.action.LOST_MODE_LOCATION_UPDATE&quot;</span> /<span class="token operator">&gt;</span>
+    
+    <span class="token operator">&lt;</span>protected-broadcast android:name<span class="token operator">=</span><span class="token string">&quot;com.vt.dlna.PARAM_DEV_UPDATE&quot;</span> /<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.遇到selinxu avc权限问题，可以通过在debug版本<strong>adb shell setenforce 0</strong>，暂时关闭验证。如果正常则慢慢给system_app添加权限解决。</p>`,17),u={href:"https://blog.csdn.net/qq_17525769/article/details/131580740",target:"_blank",rel:"noopener noreferrer"};function k(d,m){const a=p("ExternalLinkIcon");return t(),o("div",null,[i,n("p",null,[s("本文转自 "),n("a",u,[s("https://blog.csdn.net/qq_17525769/article/details/131580740"),c(a)]),s("，如有侵权，请联系删除。")])])}const v=e(r,[["render",k],["__file","nazhisystem_appxitongyingyongdezhuyishixiang.html.vue"]]);export{v as default};
