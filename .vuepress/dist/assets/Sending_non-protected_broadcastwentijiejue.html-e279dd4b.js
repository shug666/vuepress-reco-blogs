import{_ as t,r as e,o,c as p,b as s,d as n,e as c,a as l}from"./app-e8f85126.js";const i={},r=l(`<h2 id="一、问题出现的现象" tabindex="-1"><a class="header-anchor" href="#一、问题出现的现象" aria-hidden="true">#</a> 一、问题出现的现象</h2><p>发广播时，控制台报以下错误：</p><p>2023-09-07 16:18:23.603 2069-2501 ActivityManager system_process E</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Sending non-protected broadcast com.fs.widget.broadcast.DIALOG_SHOW from system 12015:com.fs.settings/1000 pkg com.fs.settings
             java.lang.Throwable
             at com.android.server.am.ActivityManagerService.checkBroadcastFromSystem(ActivityManagerService.java:21659)
             at com.android.server.am.ActivityManagerService.broadcastIntentLocked(ActivityManagerService.java:22269)
             at com.android.server.am.ActivityManagerService.broadcastIntent(ActivityManagerService.java:22411)
             at android.app.IActivityManager$Stub.onTransact$broadcastIntent$(IActivityManager.java:10171)
             at android.app.IActivityManager$Stub.onTransact(IActivityManager.java:167)
             at com.android.server.am.ActivityManagerService.onTransact(ActivityManagerService.java:3368)
             at android.os.Binder.execTransact(Binder.java:749)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发出的广播可以被目标正常接收，功能正常运行。只是会报上面的 ERROR 级别的错误。</p><h2 id="二、原因" tabindex="-1"><a class="header-anchor" href="#二、原因" aria-hidden="true">#</a> 二、原因</h2><p>基于android 12</p><p>源码路径：frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkBroadcastFromSystem</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">,</span> <span class="token class-name">ProcessRecord</span> callerApp<span class="token punctuation">,</span>
            <span class="token class-name">String</span> callerPackage<span class="token punctuation">,</span> <span class="token keyword">int</span> callingUid<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isProtectedBroadcast<span class="token punctuation">,</span> <span class="token class-name">List</span> receivers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_RECEIVER_FROM_SHELL</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Don&#39;t yell about broadcasts sent via shell</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">final</span> <span class="token class-name">String</span> action <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isProtectedBroadcast
                <span class="token operator">||</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CLOSE_SYSTEM_DIALOGS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DISMISS_KEYBOARD_SHORTCUTS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MEDIA_BUTTON</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_SHOW_KEYBOARD_SHORTCUTS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASTER_CLEAR</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_FACTORY_RESET</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">AppWidgetManager</span><span class="token punctuation">.</span><span class="token constant">ACTION_APPWIDGET_CONFIGURE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">AppWidgetManager</span><span class="token punctuation">.</span><span class="token constant">ACTION_APPWIDGET_UPDATE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">TelephonyManager</span><span class="token punctuation">.</span><span class="token constant">ACTION_REQUEST_OMADM_CONFIGURATION_UPDATE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">SuggestionSpan</span><span class="token punctuation">.</span><span class="token constant">ACTION_SUGGESTION_PICKED</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">AudioEffect</span><span class="token punctuation">.</span><span class="token constant">ACTION_OPEN_AUDIO_EFFECT_CONTROL_SESSION</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token class-name">AudioEffect</span><span class="token punctuation">.</span><span class="token constant">ACTION_CLOSE_AUDIO_EFFECT_CONTROL_SESSION</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Broadcast is either protected, or it&#39;s a public action that</span>
            <span class="token comment">// we&#39;ve relaxed, so it&#39;s fine for system internals to send.</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// This broadcast may be a problem...  but there are often system components that</span>
        <span class="token comment">// want to send an internal broadcast to themselves, which is annoying to have to</span>
        <span class="token comment">// explicitly list each action as a protected broadcast, so we will check for that</span>
        <span class="token comment">// one safe case and allow it: an explicit broadcast, only being received by something</span>
        <span class="token comment">// that has protected itself.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> intent<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>receivers <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> receivers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Intent is explicit and there&#39;s no receivers.</span>
                <span class="token comment">// This happens, e.g. , when a system component sends a broadcast to</span>
                <span class="token comment">// its own runtime receiver, and there&#39;s no manifest receivers for it,</span>
                <span class="token comment">// because this method is called twice for each broadcast,</span>
                <span class="token comment">// for runtime receivers and manifest receivers and the later check would find</span>
                <span class="token comment">// no receivers.</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">boolean</span> allProtected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> receivers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> target <span class="token operator">=</span> receivers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token keyword">instanceof</span> <span class="token class-name">ResolveInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ResolveInfo</span> ri <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ResolveInfo</span><span class="token punctuation">)</span>target<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>ri<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>exported <span class="token operator">&amp;&amp;</span> ri<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>permission <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        allProtected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">BroadcastFilter</span> bf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BroadcastFilter</span><span class="token punctuation">)</span>target<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>bf<span class="token punctuation">.</span>requiredPermission <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        allProtected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>allProtected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// All safe!</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// The vast majority of broadcasts sent from system internals</span>
        <span class="token comment">// should be protected to avoid security holes, so yell loudly</span>
        <span class="token comment">// to ensure we examine these cases.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>callerApp <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">wtf</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Sending non-protected broadcast &quot;</span> <span class="token operator">+</span> action
                            <span class="token operator">+</span> <span class="token string">&quot; from system &quot;</span> <span class="token operator">+</span> callerApp<span class="token punctuation">.</span><span class="token function">toShortString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; pkg &quot;</span> <span class="token operator">+</span> callerPackage<span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">wtf</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;Sending non-protected broadcast &quot;</span> <span class="token operator">+</span> action
                            <span class="token operator">+</span> <span class="token string">&quot; from system uid &quot;</span> <span class="token operator">+</span> <span class="token class-name">UserHandle</span><span class="token punctuation">.</span><span class="token function">formatUid</span><span class="token punctuation">(</span>callingUid<span class="token punctuation">)</span>
                            <span class="token operator">+</span> <span class="token string">&quot; pkg &quot;</span> <span class="token operator">+</span> callerPackage<span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三、代码分析" tabindex="-1"><a class="header-anchor" href="#三、代码分析" aria-hidden="true">#</a> 三、代码分析</h2><p>这个方法的目的是检查系统应用发出的广播是否有问题。</p><ol><li>如果是从 shell 发出的广播，检查通过。</li><li>如果是 isProtectedBroadcast 或是 以下列表中的固定 action，检查通过。</li></ol><blockquote><p>|| Intent.ACTION_CLOSE_SYSTEM_DIALOGS.equals(action)<br> || Intent.ACTION_DISMISS_KEYBOARD_SHORTCUTS.equals(action)<br> || Intent.ACTION_MEDIA_BUTTON.equals(action)<br> || Intent.ACTION_MEDIA_SCANNER_SCAN_FILE.equals(action)<br> || Intent.ACTION_SHOW_KEYBOARD_SHORTCUTS.equals(action)<br> || Intent.ACTION_MASTER_CLEAR.equals(action)<br> || Intent.ACTION_FACTORY_RESET.equals(action)<br> || AppWidgetManager.ACTION_APPWIDGET_CONFIGURE.equals(action)<br> || AppWidgetManager.ACTION_APPWIDGET_UPDATE.equals(action)<br> || TelephonyManager.ACTION_REQUEST_OMADM_CONFIGURATION_UPDATE.equals(action)<br> || SuggestionSpan.ACTION_SUGGESTION_PICKED.equals(action)<br> || AudioEffect.ACTION_OPEN_AUDIO_EFFECT_CONTROL_SESSION.equals(action)<br> || AudioEffect.ACTION_CLOSE_AUDIO_EFFECT_CONTROL_SESSION.equals(action)</p></blockquote><ol start="3"><li>如果 Intent 指定了 Package 或 Component 时，若 action的目标（如receiver）是 exported的 且设置了权限，检查通过。</li><li>如果目标是 BroadcastFilter 且设置了权限，检查通过。</li><li>以上四条都不满足，则在日志系统中，打印出 Throwable 信息。</li></ol><h2 id="四、解决方法" tabindex="-1"><a class="header-anchor" href="#四、解决方法" aria-hidden="true">#</a> 四、解决方法</h2><h3 id="_4-1-针对-代码分析的第二条-如果是-isprotectedbroadcast-或是-以下列表中的固定-action-检查通过。" tabindex="-1"><a class="header-anchor" href="#_4-1-针对-代码分析的第二条-如果是-isprotectedbroadcast-或是-以下列表中的固定-action-检查通过。" aria-hidden="true">#</a> 4.1 针对 代码分析的第二条“如果是 isProtectedBroadcast 或是 以下列表中的固定 action，检查通过。”</h3><p>很简单，让 <code>isProtectedBroadcast == true</code> 就ok了，需要修改 android 源码，文件路径为：</p><blockquote><p>frameworks/base/core/res/AndroidManifest.xml</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">&lt;</span>manifest xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="token keyword">package</span><span class="token operator">=</span><span class="token string">&quot;android&quot;</span> coreApp<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> android<span class="token operator">:</span>sharedUserId<span class="token operator">=</span><span class="token string">&quot;android.uid.system&quot;</span>
    android<span class="token operator">:</span>sharedUserLabel<span class="token operator">=</span><span class="token string">&quot;@string/android_system_label&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token class-name">Special</span> broadcasts that only the system can send <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.SCREEN_OFF&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.SCREEN_ON&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.USER_PRESENT&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.TIME_SET&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.TIME_TICK&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.TIMEZONE_CHANGED&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.DATE_CHANGED&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.PRE_BOOT_COMPLETED&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.BOOT_COMPLETED&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.PACKAGE_INSTALL&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.PACKAGE_ADDED&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.PACKAGE_REPLACED&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">protected</span><span class="token operator">-</span>broadcast android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.intent.action.MY_PACKAGE_REPLACED&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>依照内容，添加自己的 action ，重新编译系统，新rom上就可以正常发送，不报异常了。</p><h3 id="_4-2-针对-代码分析的第三条-如果-intent-指定了-package-或-component-时-若-action的目标-如receiver-是-exported的-且设置了权限-检查通过。" tabindex="-1"><a class="header-anchor" href="#_4-2-针对-代码分析的第三条-如果-intent-指定了-package-或-component-时-若-action的目标-如receiver-是-exported的-且设置了权限-检查通过。" aria-hidden="true">#</a> 4.2 针对 代码分析的第三条“如果 Intent 指定了 Package 或 Component 时，若 action的目标（如receiver）是 exported的 且设置了权限，检查通过。”</h3><h4 id="_4-2-1-action的接收方" tabindex="-1"><a class="header-anchor" href="#_4-2-1-action的接收方" aria-hidden="true">#</a> 4.2.1 Action的接收方：</h4><p>定义权限：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>sharedUserId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.uid.system<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>com.android.permission.MY_PERMISSION<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用权限：(注意 exported 与 permission 必须都设置)</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.receiver.ShowSettingDialogReceiver<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.android.permission.MY_PERMISSION<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-2-action的发送方" tabindex="-1"><a class="header-anchor" href="#_4-2-2-action的发送方" aria-hidden="true">#</a> 4.2.2 Action的发送方：</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Intent</span></span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> showSettingDialogIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
showSettingDialogIntent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token constant">ACTION_BLUETOOTH_DIALOG_SHOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
showSettingDialogIntent<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token constant">PACKAGE_SETTINGS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sendBroadcast</span><span class="token punctuation">(</span>showSettingDialogIntent<span class="token punctuation">,</span> <span class="token string">&quot;com.android.permission.MY_PERMISSION&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,28),u={href:"https://blog.csdn.net/brillian_green/article/details/132740699",target:"_blank",rel:"noopener noreferrer"};function k(d,v){const a=e("ExternalLinkIcon");return o(),p("div",null,[r,s("p",null,[n("本文转自 "),s("a",u,[n("https://blog.csdn.net/brillian_green/article/details/132740699"),c(a)]),n("，如有侵权，请联系删除。")])])}const b=t(i,[["render",k],["__file","Sending_non-protected_broadcastwentijiejue.html.vue"]]);export{b as default};
