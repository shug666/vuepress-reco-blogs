import{_ as t,r as p,o as c,c as l,b as n,d as a,e,a as i}from"./app-e8f85126.js";const o={},r=i(`<h2 id="一、前言" tabindex="-1"><a class="header-anchor" href="#一、前言" aria-hidden="true">#</a> 一、前言</h2><p>Android 原生设置Settings应用很多界面都是使用xml的PreferenceScreen形式进行显示，PreferenceScreen 里面包含很多条目，如果要隐藏某个条目就要修改xml或者Java代码， 有些情况修改xml是无效的，修改Java代码才有作用。</p><p>本文简单记录一下Settings PreferenceScreen 某个条目隐藏实现。</p><p>网上百度到的像View那样隐藏item的代码肯定是不对的，这种 Preference 代码的显示和隐藏使用的是View的那套。</p><p>上面百度生成的答案是错误的参考示例。</p><p>具体实现下面有分析讲解。</p><h2 id="二、隐藏实现" tabindex="-1"><a class="header-anchor" href="#二、隐藏实现" aria-hidden="true">#</a> 二、隐藏实现</h2><p>已原生Android14 Settings的某个xml和相关Java文件做讲解。</p><h3 id="_1、xml-文件中隐藏preferencescreen-的某个条目" tabindex="-1"><a class="header-anchor" href="#_1、xml-文件中隐藏preferencescreen-的某个条目" aria-hidden="true">#</a> 1、xml 文件中隐藏PreferenceScreen 的某个条目</h3><p>wifi设置里面的“网络偏好设置”的xml 布局：</p><p><code>Settings\\res\\xml\\wifi_configure_settings.xml</code></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PreferenceScreen</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>settings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/wifi_configure_settings_preference_title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SwitchPreference</span>
        <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>enable_wifi_wakeup<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/wifi_wakeup<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@drawable/ic_auto_wifi<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>summary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/wifi_wakeup_summary<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">settings:</span>isPreferenceVisible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">settings:</span>controller</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.android.settings.wifi.WifiWakeupPreferenceController<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SwitchPreference</span>
        <span class="token attr-name"><span class="token namespace">android:</span>isPreferenceVisible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ethernet_turn_off<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>summary</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ethernet info<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ethernet_turn_off<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Preference</span>
        <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>install_credentials<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">settings:</span>isPreferenceVisible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/wifi_install_credentials<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Preference</span>
        <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wifi_direct<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">settings:</span>isPreferenceVisible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/wifi_menu_p2p<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>fragment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.android.settings.wifi.p2p.WifiP2pSettings<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PreferenceScreen</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的条目都添加了隐藏代码：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>settings:isPreferenceVisible=&quot;false&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>但是实际上只有 ethernet_turn_off 和 install_credentials 会隐藏，其他的条目设置后是没有作用的。</strong></p><p>所以xml中直接写隐藏实现，是不一定有用的，实际项目中需要查看Java代码中有没有对其进行控制。</p><p>查看一下Java实现代码发现要做如下修改才能隐藏相关条目：</p><h3 id="_2、普通preference条目的隐藏的java代码实现" tabindex="-1"><a class="header-anchor" href="#_2、普通preference条目的隐藏的java代码实现" aria-hidden="true">#</a> 2、普通Preference条目的隐藏的Java代码实现</h3><p>&quot;WLAN直连&quot;选项：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WifiP2pPreferenceController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractPreferenceController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_WIFI_DIRECT</span> <span class="token operator">=</span> <span class="token string">&quot;wifi_direct&quot;</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//false 是不可见</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AbstractPreferenceController 是 androidx.preference.Preference 原生的，实现 isAvailable() 方法即可决定该条目的隐藏和显示。</p><h3 id="_3、switchpreference条目的隐藏的java代码实现" tabindex="-1"><a class="header-anchor" href="#_3、switchpreference条目的隐藏的java代码实现" aria-hidden="true">#</a> 3、SwitchPreference条目的隐藏的Java代码实现</h3><p>&quot;自动开启WLAN&quot;选项：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WifiWakeupPreferenceController</span> <span class="token keyword">extends</span> <span class="token class-name">TogglePreferenceController</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_ENABLE_WIFI_WAKEUP</span> <span class="token operator">=</span> <span class="token string">&quot;enable_wifi_wakeup&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAvailabilityStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//set visible false change by liwenzhi</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant">DISABLED_FOR_USER</span><span class="token punctuation">;</span> <span class="token comment">//不可见</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">AVAILABLE</span><span class="token punctuation">;</span> <span class="token comment">//可见</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TogglePreferenceController 是 Settings自定义的，实现 getAvailabilityStatus() 方法即可决定该条目的隐藏和显示。</p><h3 id="_4、查找-preference-对应java代码的思路" tabindex="-1"><a class="header-anchor" href="#_4、查找-preference-对应java代码的思路" aria-hidden="true">#</a> 4、查找 Preference 对应Java代码的思路</h3><p>xml 中 Preference 主要代码：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XXXPreference</span>
    <span class="token attr-name"><span class="token namespace">android:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>keyName<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">...</span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每个 Preference 都是要定义key 的，Java代码所以Java代码中要找到这个 Preference ，就要通过这个keyName ，类似findViewById那样。</p><p>所以控制这个 Preference 的Java 代码，肯定会定义对应的keyName。</p><p>而找到这个 Preference 也是可以手动对其进行隐藏或者显示的。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SwitchPreference</span> switchPreference <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SwitchPreference</span><span class="token punctuation">)</span> <span class="token function">findPreference</span><span class="token punctuation">(</span><span class="token string">&quot;ethernet_turn_off&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
switchPreference<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true是显示，false是隐藏</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、其他" tabindex="-1"><a class="header-anchor" href="#三、其他" aria-hidden="true">#</a> 三、其他</h3><h4 id="_1、preference-条目的隐藏的思路" tabindex="-1"><a class="header-anchor" href="#_1、preference-条目的隐藏的思路" aria-hidden="true">#</a> 1、Preference 条目的隐藏的思路</h4><p>（1）查看Java代码中有没有控制 Preference 的显示和隐藏</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">1</span>、查看对于的控制类有没有 <span class="token function">isAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 方法的实现
<span class="token number">2</span>、查看对应的控制类有没有 <span class="token function">getAvailabilityStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 方法的实现
<span class="token number">3</span>、查看对应的控制类没有直接控制 setVisible 方法的调用
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）如果Java代码没有控制直接在xml中修改即可</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>settings<span class="token operator">:</span>isPreferenceVisible<span class="token operator">=</span><span class="token string">&quot;false&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果需要自己属性控制隐藏显示的，那么也是只能在Java代码中控制。</p><p>简单的说就是xml修改显示隐藏不一定生效，主要还是要看Java 是否控制。</p><h4 id="_2、android-preference简单介绍" tabindex="-1"><a class="header-anchor" href="#_2、android-preference简单介绍" aria-hidden="true">#</a> 2、Android Preference简单介绍</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">PreferenceScreen</span>和<span class="token class-name">SwitchPreference</span> 简单示例
相关demo代码示例
（<span class="token number">1</span>）<span class="token class-name">SettingsActivity<span class="token punctuation">.</span>Java</span>
（<span class="token number">2</span>）layout\\settings_activity<span class="token punctuation">.</span>xml
（<span class="token number">3</span>）xml\\root_preferences<span class="token punctuation">.</span>xml
（<span class="token number">4</span>）build<span class="token punctuation">.</span>gradle
（<span class="token number">5</span>）示例demo效果：
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相关链接：</p>`,43),u={href:"https://blog.csdn.net/wenzhi20102321/article/details/136902514",target:"_blank",rel:"noopener noreferrer"},d={href:"https://blog.csdn.net/wenzhi20102321/article/details/140360299",target:"_blank",rel:"noopener noreferrer"};function k(v,m){const s=p("ExternalLinkIcon");return c(),l("div",null,[r,n("p",null,[n("a",u,[a("https://blog.csdn.net/wenzhi20102321/article/details/136902514"),e(s)])]),n("p",null,[a("本文转自 "),n("a",d,[a("https://blog.csdn.net/wenzhi20102321/article/details/140360299"),e(s)]),a("，如有侵权，请联系删除。")])])}const f=t(o,[["render",k],["__file","Settings_PreferenceScreentiaomuyincangshixian.html.vue"]]);export{f as default};
