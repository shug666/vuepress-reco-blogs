import{_ as e,r as t,o as l,c as p,b as a,d as s,e as i,a as o}from"./app-52856ff7.js";const c={},r=o(`<h2 id="用法" tabindex="-1"><a class="header-anchor" href="#用法" aria-hidden="true">#</a> 用法</h2><p>将脚本置于源码目录下，最好lunch一下你的工程</p><p>生成的签名文件为工程名称_AN_版本号</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">chmod</span> +x ./auto_build_signature.sh
<span class="token function">chmod</span> <span class="token number">777</span>  ./auto_build_signature.sh

<span class="token comment">#默认的存储密码，别名，秘钥密码</span>
<span class="token comment">#[Shugan:AutoBuildSignature]创建签名文件的存储密码为android</span>
<span class="token comment">#[Shugan:AutoBuildSignature]创建签名文件的别名 androiddebugkey</span>
<span class="token comment">#[Shugan:AutoBuildSignature]创建签名文件的签名密码 android</span>
<span class="token builtin class-name">source</span> auto_build_signature.sh
<span class="token comment">#source auto_build_signature.sh Android_studio的存储密码  Android_studio的Alias别名  Android_studio的密钥密码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="脚本内容" tabindex="-1"><a class="header-anchor" href="#脚本内容" aria-hidden="true">#</a> 脚本内容</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 使用前需source build/envsetup.sh &amp;&amp; lunch</span>
<span class="token comment"># 固定值</span>
<span class="token assign-left variable">KEY_STORED_PASSWORD</span><span class="token operator">=</span>android
<span class="token assign-left variable">KEY_ALIAS</span><span class="token operator">=</span>androiddebugkey
<span class="token assign-left variable">KEY_PASSWORD</span><span class="token operator">=</span>android
<span class="token comment">#在命令行输入参数</span>
<span class="token comment"># KEY_STORED_PASSWORD=$1</span>
<span class="token comment"># KEY_ALIAS=$2</span>
<span class="token comment"># KEY_PASSWORD=$3</span>
<span class="token assign-left variable">DIR_NAME</span><span class="token operator">=</span><span class="token string">&quot;createSignature&quot;</span>
<span class="token assign-left variable">PRODUCT_NAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span>get_build_var TARGET_PRODUCT<span class="token variable">\`</span></span>
<span class="token assign-left variable">VERSION_NAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span>get_build_var PLATFORM_VERSION<span class="token variable">\`</span></span>
<span class="token assign-left variable">LOG_TAG</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\\033">\\033</span>[34m[Shugan:AutoBuildSignature]<span class="token entity" title="\\033">\\033</span>[0m&quot;</span>
<span class="token assign-left variable">LOG_END</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\\033">\\033</span>[0m&quot;</span>
<span class="token assign-left variable">FILE_NAME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${PRODUCT_NAME}</span>_AN_<span class="token variable">\${VERSION_NAME}</span>.jks&quot;</span>
<span class="token function-name function">do_main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;----- do_main ----&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$KEY_STORED_PASSWORD</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$KEY_STORED_PASSWORD</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;-h&quot;</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$KEY_STORED_PASSWORD</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;--h&quot;</span> <span class="token punctuation">]</span>
        <span class="token keyword">then</span> 
        <span class="token comment">#echo -e &quot;\${LOG_TAG}\\033[31mYour should add correct params .For Exapmle \${LOG_END}&quot;</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span><span class="token entity" title="\\033">\\033</span>[31m参数错误,使用示例如下<span class="token variable">\${LOG_END}</span>&quot;</span>
        <span class="token comment">#echo -e &quot;\${LOG_TAG}\\033[31m./auto_build_signature.sh key_stored_password key_alias key_password \${LOG_END}&quot;</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span><span class="token entity" title="\\033">\\033</span>[31m./auto_build_signature.sh Android studio的存储密码  Android studio的Alias别名  Android studio的密钥密码 <span class="token variable">\${LOG_END}</span>&quot;</span>
        <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$PRODUCT_NAME</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$PLATFORM_VERSION</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span>
        <span class="token keyword">then</span> 
        <span class="token assign-left variable">FILE_NAME</span><span class="token operator">=</span><span class="token string">&quot;platform.jks&quot;</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$KEY_ALIAS</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token comment">#echo -e &quot;\${LOG_TAG}\\033[31mOnly one extra param .use $1 to set key alias and key password \${LOG_END}&quot;</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span><span class="token entity" title="\\033">\\033</span>[31m当前只传递了Android studio的存储密码,使用<span class="token entity" title="\\033">\\033</span>[33m<span class="token variable">$1</span><span class="token variable">\${LOG_END}</span>来替代Android studio的Alias别名/Android studio的密钥密码<span class="token variable">\${LOG_END}</span>&quot;</span>
        <span class="token assign-left variable">KEY_ALIAS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$KEY_STORED_PASSWORD</span>&quot;</span>
        <span class="token assign-left variable">KEY_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$KEY_STORED_PASSWORD</span>&quot;</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$KEY_PASSWORD</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token comment">#echo -e &quot;\${LOG_TAG}\\033[31mOnly two extra param .use $1 to set key password  \${LOG_END}&quot;</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span><span class="token entity" title="\\033">\\033</span>[31m当前只传递了Android studio的存储密码和Android studio的Alias别名,使用<span class="token entity" title="\\033">\\033</span>[33m<span class="token variable">$1</span><span class="token variable">\${LOG_END}</span>来替代Android studio的密钥密码<span class="token variable">\${LOG_END}</span>&quot;</span>
        <span class="token assign-left variable">KEY_PASSWORD</span><span class="token operator">=</span><span class="token variable">$KEY_STORED_PASSWORD</span>
    <span class="token keyword">fi</span>

    <span class="token comment">#echo -e &quot;\${LOG_TAG}Creatingkey \\033[33mstored password is $KEY_STORED_PASSWORD\${LOG_END}&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span>创建签名文件的<span class="token entity" title="\\033">\\033</span>[33m存储密码 <span class="token variable">$KEY_STORED_PASSWORD</span><span class="token variable">\${LOG_END}</span>&quot;</span>
    <span class="token comment">#echo -e &quot;\${LOG_TAG}Creatingkey \\033[36malias is $KEY_ALIAS\${LOG_END}&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span>创建签名文件的<span class="token entity" title="\\033">\\033</span>[36m别名 <span class="token variable">$KEY_ALIAS</span><span class="token variable">\${LOG_END}</span>&quot;</span>
    <span class="token comment">#echo -e &quot;\${LOG_TAG}Creatingkey \\033[35mpassword is $KEY_PASSWORD\${LOG_END}&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span>创建签名文件的<span class="token entity" title="\\033">\\033</span>[35m签名密码 <span class="token variable">$KEY_PASSWORD</span><span class="token variable">\${LOG_END}</span>&quot;</span>

    <span class="token function">mkdir</span> <span class="token variable">$DIR_NAME</span>
    <span class="token function">cp</span> build/target/product/security/platform.pk8 ./<span class="token variable">$DIR_NAME</span>
    <span class="token function">cp</span> build/target/product/security/platform.x509.pem ./<span class="token variable">$DIR_NAME</span>
    <span class="token function">cp</span> prebuilts/sdk/tools/lib/signapk.jar ./<span class="token variable">$DIR_NAME</span>
    <span class="token function">cp</span> prebuilts/sdk/tools/linux/lib64/libconscrypt_openjdk_jni.so ./<span class="token variable">$DIR_NAME</span>
    <span class="token builtin class-name">cd</span> ./<span class="token variable">$DIR_NAME</span>
    openssl pkcs8 <span class="token parameter variable">-inform</span> DER <span class="token parameter variable">-nocrypt</span> <span class="token parameter variable">-in</span> platform.pk8 <span class="token parameter variable">-out</span> platform.pem
    openssl pkcs12 <span class="token parameter variable">-export</span> <span class="token parameter variable">-in</span> platform.x509.pem <span class="token parameter variable">-out</span> platform.p12 <span class="token parameter variable">-inkey</span> platform.pem <span class="token parameter variable">-password</span> pass:<span class="token variable">$KEY_STORED_PASSWORD</span> <span class="token parameter variable">-name</span> <span class="token variable">$KEY_ALIAS</span>
    keytool <span class="token parameter variable">-importkeystore</span> <span class="token parameter variable">-deststorepass</span> <span class="token variable">$KEY_PASSWORD</span> <span class="token parameter variable">-destkeystore</span> ./<span class="token variable">$FILE_NAME</span> <span class="token parameter variable">-srckeystore</span> ./platform.p12 <span class="token parameter variable">-srcstoretype</span> PKCS12 <span class="token parameter variable">-srcstorepass</span> <span class="token variable">$KEY_STORED_PASSWORD</span>

    <span class="token function">mv</span> <span class="token variable">$FILE_NAME</span> <span class="token punctuation">..</span>/<span class="token variable">$FILE_NAME</span>
    <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>

    <span class="token keyword">if</span>  <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;<span class="token variable">$FILE_NAME</span>&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span> 
        <span class="token comment">#echo -e &quot;\\r\\n\\r\\n\\r\\n\${LOG_TAG}\\033[32mFile Created Success !!! \${LOG_END}&quot;</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token entity" title="\\r">\\r</span><span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\r">\\r</span><span class="token entity" title="\\n">\\n</span><span class="token entity" title="\\r">\\r</span><span class="token entity" title="\\n">\\n</span><span class="token variable">\${LOG_TAG}</span><span class="token entity" title="\\033">\\033</span>[32m签名文件创建成功 !!! <span class="token variable">\${LOG_END}</span>&quot;</span>
    <span class="token keyword">else</span>
        <span class="token comment">#echo -e &quot;\${LOG_TAG}\\033[31mFile Created Faild. Please Recheck !!! \${LOG_END}&quot;</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">\${LOG_TAG}</span><span class="token entity" title="\\033">\\033</span>[31m签名文件创建失败,请确认是否在源码根目录以及参数是否正常 !!! <span class="token variable">\${LOG_END}</span>&quot;</span>
        <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
    <span class="token keyword">fi</span>
    <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token variable">$DIR_NAME</span>
<span class="token punctuation">}</span>
do_main
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),u={href:"https://blog.csdn.net/qq_18906227/article/details/124673441?spm=1001.2014.3001.5502",target:"_blank",rel:"noopener noreferrer"};function d(k,v){const n=t("ExternalLinkIcon");return l(),p("div",null,[r,a("p",null,[s("本文转自 "),a("a",u,[s("https://blog.csdn.net/qq_18906227/article/details/124673441?spm=1001.2014.3001.5502"),i(n)]),s("，如有侵权，请联系删除。")])])}const b=e(c,[["render",d],["__file","Android-yuanmachuangjianshengchengjksqianmingwenjianjiaoben.html.vue"]]);export{b as default};
